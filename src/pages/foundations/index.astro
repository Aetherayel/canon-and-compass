---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import TopLayout from "@layouts/TopLayout.astro";
import BottomLayout from "@layouts/BottomLayout.astro";
import StackCard from "@components/StackCard.astro";
import { FOUNDATIONS, CANONNOTES, COMPASSPOINTS, PILLARS } from "@consts";

const canonNotes = (await getCollection("canon_notes")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const compassPoints = (await getCollection("compass_points")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const pillars = (await getCollection("pillars")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const recentFoundations = [...canonNotes, ...compassPoints, ...pillars]
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 6);
---

<PageLayout title={FOUNDATIONS.TITLE} description={FOUNDATIONS.DESCRIPTION}>
  <TopLayout>
    <div class="animate space-y-4">
      <div>
        <h1 class="text-3xl font-semibold text-black dark:text-white mt-2">
          {FOUNDATIONS.TITLE}
        </h1>
        <p class="mt-2 text-lg italic text-neutral-700 dark:text-neutral-300">
          Formation is slower than insight.<br />
          And that is not a flaw.
        </p>
      </div>
      <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
        <p>Foundations are not meant to be entered first.</p>
        <p>
          They exist because naming a problem does not, by itself, heal it &mdash; and
          because truth that is not given time to take root often becomes another thing
          we try to manage.
        </p>
        <p>
          If you've arrived here directly, pause for a moment.<br />
          This space makes more sense when you know <strong>what it is supporting</strong>.
        </p>
      </div>
    </div>
  </TopLayout>
  <BottomLayout>
    <div class="animate space-y-12">
      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          What Foundations Are
        </h2>
        <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
          <p>Foundations are <strong>formation layers</strong>.</p>
          <p>They are designed to help truth:</p>
          <ul class="list-disc pl-6 space-y-1">
            <li>settle beneath awareness</li>
            <li>resist cultural pressure</li>
            <li>remain steady when emotion fluctuates</li>
            <li>shape instincts over time</li>
          </ul>
          <p>They do not diagnose what's wrong.</p>
          <p>They do not chart the terrain.</p>
          <p>They reinforce what has already been named.</p>
        </div>
      </section>

      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          What Foundations Are Not
        </h2>
        <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
          <p>Foundations are not:</p>
          <ul class="list-disc pl-6 space-y-1">
            <li>a starting point</li>
            <li>a library to browse</li>
            <li>a shortcut to maturity</li>
            <li>a replacement for discernment</li>
          </ul>
          <p>
            Reading deeply without orientation can feel productive &mdash; but it often
            strengthens the very habits formation is meant to undo.
          </p>
          <p>Foundations are meant to be <strong>entered slowly</strong>, with context.</p>
        </div>
      </section>

      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          How Foundations Fit into the Whole
        </h2>
        <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
          <p>This site is designed as a <strong>movement</strong>, not a catalog.</p>
          <p>Most journeys follow a rhythm like this:</p>
          <ul class="list-disc pl-6 space-y-1">
            <li><strong>The Clearing</strong> &mdash; regaining bearings</li>
            <li><strong>The Forests</strong> &mdash; naming the environments that formed you</li>
            <li><strong>Fruit Paths</strong> &mdash; recognizing what is growing in your life</li>
            <li><strong>Foundations</strong> &mdash; letting truth reshape you over time</li>
          </ul>
          <p>
            Foundations come <em>after</em> something has been named &mdash; not before.
          </p>
          <p>They exist so insight doesn't collapse into striving.</p>
        </div>
      </section>

      <section class="space-y-6">
        <div class="space-y-2">
          <h2 class="text-xl font-semibold text-black dark:text-white">
            The Three Kinds of Foundations
          </h2>
          <p class="text-base text-neutral-700 dark:text-neutral-300">
            Each Foundation serves a different formative role.
          </p>
        </div>
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
          <a
            href="/canon_notes"
            class="group rounded-2xl border border-black/10 bg-white/70 p-6 shadow-sm transition-colors duration-300 ease-in-out hover:bg-black/5 dark:border-white/15 dark:bg-zinc-900/70 dark:hover:bg-white/10"
          >
            <h3 class="text-lg font-semibold text-black dark:text-white">
              {CANONNOTES.TITLE}
            </h3>
            <div class="mt-2 space-y-2 text-sm text-neutral-700 dark:text-neutral-300">
              <p>Short, Scripture-anchored reflections.</p>
              <p>These are meant to be returned to &mdash; not consumed.</p>
              <p>They slow the soul and retrain attention toward what is true.</p>
            </div>
            <div class="mt-4 text-sm font-semibold text-black transition-colors duration-300 ease-in-out group-hover:text-black/70 dark:text-white dark:group-hover:text-white/70">
              Enter {CANONNOTES.TITLE} &rarr;
            </div>
          </a>
          <a
            href="/compass_points"
            class="group rounded-2xl border border-black/10 bg-white/70 p-6 shadow-sm transition-colors duration-300 ease-in-out hover:bg-black/5 dark:border-white/15 dark:bg-zinc-900/70 dark:hover:bg-white/10"
          >
            <h3 class="text-lg font-semibold text-black dark:text-white">
              {COMPASSPOINTS.TITLE}
            </h3>
            <div class="mt-2 space-y-2 text-sm text-neutral-700 dark:text-neutral-300">
              <p>Cultural and systemic reflections.</p>
              <p>
                These help you recognize when the world is quietly re-forming you
                back into old patterns.
              </p>
              <p>They train discernment without panic.</p>
            </div>
            <div class="mt-4 text-sm font-semibold text-black transition-colors duration-300 ease-in-out group-hover:text-black/70 dark:text-white dark:group-hover:text-white/70">
              Enter {COMPASSPOINTS.TITLE} &rarr;
            </div>
          </a>
          <a
            href="/pillars"
            class="group rounded-2xl border border-black/10 bg-white/70 p-6 shadow-sm transition-colors duration-300 ease-in-out hover:bg-black/5 dark:border-white/15 dark:bg-zinc-900/70 dark:hover:bg-white/10"
          >
            <h3 class="text-lg font-semibold text-black dark:text-white">
              {PILLARS.TITLE}
            </h3>
            <div class="mt-2 space-y-2 text-sm text-neutral-700 dark:text-neutral-300">
              <p>Longform theological and philosophical essays.</p>
              <p>These are load-bearing truths &mdash; meant to hold when pressure increases.</p>
              <p>They are not meant to be rushed.</p>
            </div>
            <div class="mt-4 text-sm font-semibold text-black transition-colors duration-300 ease-in-out group-hover:text-black/70 dark:text-white dark:group-hover:text-white/70">
              Enter {PILLARS.TITLE} &rarr;
            </div>
          </a>
        </div>
        <p class="text-base text-neutral-700 dark:text-neutral-300">
          Together, they support formation across <strong>time</strong>, not intensity.
        </p>
      </section>

      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          Where to Begin Instead
        </h2>
        <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
          <p>If you're unsure why you're here, these are better starting places:</p>
          <ul class="list-disc pl-6 space-y-1">
            <li>
              <a href="/the-clearing" class="font-semibold text-black hover:underline dark:text-white">
                The Clearing
              </a>
              &mdash; if things feel loud, confusing, or spiritually thin
            </li>
            <li>
              <a href="/forests" class="font-semibold text-black hover:underline dark:text-white">
                The Forests
              </a>
              &mdash; if you're trying to understand how the world trained you to see
            </li>
            <li>
              <a href="/symptoms" class="font-semibold text-black hover:underline dark:text-white">
                Fruit Paths
              </a>
              &mdash; if a specific pattern or struggle has become clear
            </li>
          </ul>
          <p>Foundations will still be here when they're needed.</p>
          <p>They aren't going anywhere.</p>
        </div>
      </section>

      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          A Final Word
        </h2>
        <div class="space-y-3 text-base text-neutral-700 dark:text-neutral-300">
          <p>Formation is not something you do to yourself.</p>
          <p>
            It happens when truth is given time, attention, and room to work &mdash; often
            beneath awareness, and rarely on command.
          </p>
          <p>Foundations exist to protect that process.</p>
          <p>
            If you're ready, return to the path that brought you here.<br />
            If you're not, that's not failure.
          </p>
          <p>It may be wisdom.</p>
        </div>
      </section>

      {recentFoundations.length > 0 && (
        <section class="space-y-4">
          <hr class="border-black/10 dark:border-white/15" />
          <div class="flex justify-between">
            <p class="font-semibold text-black dark:text-white">
              Recent Foundations
            </p>
          </div>
          <ul class="space-y-4">
            {recentFoundations.map((foundation) => (
              <li>
                <StackCard
                  title={foundation.data.title}
                  summary={foundation.data.summary}
                  href={`/${foundation.collection}/${foundation.slug}`}
                  collection={foundation.collection}
                  date={foundation.data.date}
                  tags={foundation.data.tags}
                />
              </li>
            ))}
          </ul>
        </section>
      )}
    </div>
  </BottomLayout>
</PageLayout>
