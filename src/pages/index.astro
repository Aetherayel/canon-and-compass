---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard";
import StackCard from "@components/StackCard.astro";
import { SITE, SOCIALS } from "@consts";
import TwinklingStars from "@components/TwinklingStars.astro";
import MeteorShower from "@components/MeteorShower.astro";

const posts = (await getCollection("tree"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

const canonNotes = (await getCollection("canon_notes")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const compassPoints = (await getCollection("compass_points")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const pillars = (await getCollection("pillars")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const foundations = [...canonNotes, ...compassPoints, ...pillars]
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

const stack = [
  {
    text: "Astro",
    icon: "astro",
    href: "https://astro.build",
  },
  {
    text: "Javascript",
    icon: "javascript",
    href: "https://www.javascript.com",
  },
  {
    text: "Typescript",
    icon: "typescript",
    href: "https://www.typescriptlang.org",
  },
  {
    text: "Tailwind",
    icon: "tailwind",
    href: "https://tailwindcss.com",
  },
];
---

<PageLayout title="Home" description={SITE.DESCRIPTION}>
  <!-- Light Mode: Particles -->
  <div class="absolute inset-0 block dark:hidden">
    <div id="particles1" class="fixed inset-0"></div>
    <div id="particles2" class="fixed inset-0"></div>
    <div id="particles3" class="fixed inset-0"></div>
  </div>

  <!-- Dark Theme: Stars -->
  <div class="absolute inset-0 bg-black hidden dark:block">
    <div id="stars1" class="fixed inset-0"></div>
    <div id="stars2" class="fixed inset-0"></div>
    <div id="stars3" class="fixed inset-0"></div>
  </div>

  <!-- Dark Theme: Twinkling Stars / Metors -->
  <div id="galaxy" class="fixed inset-0">
    <div class="hidden dark:block">
      <TwinklingStars />
      <MeteorShower />
    </div>
  </div>

  <script is:inline src="/js/bg.js"></script>

  <!-- HERO -->
  <section class="relative h-screen w-full">
    <div
      id="planetcont"
      class="animate absolute inset-0 overflow-hidden"
    >
    <div>
      <!-- SVG Mountain Footer -->
<svg
  class="absolute bottom-0 left-0 w-full h-[min(100vh,800px)] z-0 pointer-events-none"
  viewBox="0 0 1440 800"
  preserveAspectRatio="xMidYMax meet"
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <!-- Glow gradients -->
    <radialGradient id="peakGlowLight" cx="50%" cy="60%" r="70%">
      <stop offset="0%" stop-color="#d4d4d4" stop-opacity="0.4" />
      <stop offset="100%" stop-color="white" stop-opacity="0" />
    </radialGradient>
    <radialGradient id="peakGlowDark" cx="50%" cy="60%" r="70%">
      <stop offset="0%" stop-color="#ffffff" stop-opacity="0.08" />
      <stop offset="100%" stop-color="#000000" stop-opacity="0" />
    </radialGradient>

    <!-- Peak fill gradients -->
    <linearGradient id="peakFillLight" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f4f4f4" />
      <stop offset="100%" stop-color="#ffffff" />
    </linearGradient>
    <linearGradient id="peakFillDark" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#2b2b2b" />
      <stop offset="100%" stop-color="#000000" />
    </linearGradient>
    <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
  <feGaussianBlur stdDeviation="8" result="glow" />
  <feMerge>
    <feMergeNode in="glow" />
    <feMergeNode in="glow" />
    <feMergeNode in="glow" />
  </feMerge>
</filter>
  </defs>

  <!-- Glow behind -->
  <rect width="100%" height="100%" fill="url(#peakGlowLight)" class="dark:hidden" />
  <rect width="100%" height="100%" fill="url(#peakGlowDark)" class="hidden dark:block" />
<!-- Glowing 4-point star -->
<g class="pointer-events-none">
  <g transform="translate(720,100)">
    <polygon
      points="0,-30 6,-6 30,0 6,6 0,30 -6,6 -30,0 -6,-6"
      fill="white"
      fill-opacity="0.9"
      class="dark:fill-white"
    />
    <circle
      cx="0"
      cy="0"
      r="40"
      fill="white"
      fill-opacity="0.06"
      class="dark:fill-white dark:fill-opacity-10"
      filter="url(#softGlow)"
    />
  </g>
</g>
  <!-- Peaks (with thicker stroke and no bottom line) -->
  <path
    d="M0,800
       L360,250
       L720,650
       L1080,300
       L1440,800"
    fill="url(#peakFillLight)"
    stroke="#ffffff"
    stroke-width="4"
    class="dark:fill-[url(#peakFillDark)] dark:stroke-zinc-800"
    stroke-linecap="round"
    stroke-linejoin="round"
    fill-opacity="1"
  />
  <!-- Tree canopy -->
  <g class="fill-[#e0e0e0] dark:fill-[#111111]" fill-opacity="0.95" transform="translate(0 8)">
    <path d="M-5 792 L40 732 L85 792 Z M12 772 L40 712 L68 772 Z M23.2 762 L40 702 L56.8 762 Z" />
    <path d="M55 792 L110 728 L165 792 Z M73 772 L110 702 L147 772 Z M87.8 762 L110 692 L132.2 762 Z" />
    <path d="M135 792 L165 762 L195 792 Z M145 778 L165 742 L185 778 Z M153 768 L165 732 L177 768 Z" />
    <path d="M185 792 L240 724 L295 792 Z M203 770 L240 694 L277 770 Z M217.8 760 L240 684 L262.2 760 Z" />
    <path d="M265 792 L305 762 L345 792 Z M278 778 L305 742 L332 778 Z M288.8 768 L305 732 L321.2 768 Z" />
    <path d="M320 792 L360 764 L400 792 Z M333 778 L360 744 L387 778 Z M343.8 768 L360 734 L376.2 768 Z" />
    <path d="M385 792 L450 728 L515 792 Z M406 770 L450 698 L494 770 Z M423.6 760 L450 688 L476.4 760 Z" />
    <path d="M465 792 L525 722 L585 792 Z M485 770 L525 690 L565 770 Z M501 760 L525 680 L549 760 Z" />
    <path d="M550 792 L595 762 L640 792 Z M565 778 L595 742 L625 778 Z M577 768 L595 732 L613 768 Z" />
    <path d="M615 792 L680 726 L745 792 Z M637 770 L680 696 L723 770 Z M654.2 760 L680 686 L705.8 760 Z" />
    <path d="M695 792 L750 744 L805 792 Z M713 772 L750 716 L787 772 Z M727.8 762 L750 706 L772.2 762 Z" />
    <path d="M775 792 L820 764 L865 792 Z M789 778 L820 744 L851 778 Z M801.4 768 L820 734 L838.6 768 Z" />
    <path d="M835 792 L900 720 L965 792 Z M857 770 L900 692 L943 770 Z M874.2 760 L900 682 L925.8 760 Z" />
    <path d="M930 792 L965 762 L1000 792 Z M941 778 L965 742 L989 778 Z M950.6 768 L965 732 L979.4 768 Z" />
    <path d="M995 792 L1040 764 L1085 792 Z M1010 778 L1040 744 L1070 778 Z M1022 768 L1040 734 L1058 768 Z" />
    <path d="M1050 792 L1125 726 L1200 792 Z M1075 770 L1125 696 L1175 770 Z M1095 760 L1125 686 L1155 760 Z" />
    <path d="M1150 792 L1215 720 L1280 792 Z M1172 770 L1215 690 L1258 770 Z M1189.2 760 L1215 680 L1240.8 760 Z" />
    <path d="M1230 792 L1285 744 L1340 792 Z M1248 772 L1285 716 L1322 772 Z M1262.8 762 L1285 706 L1307.2 762 Z" />
    <path d="M1310 792 L1348 764 L1386 792 Z M1322 778 L1348 744 L1374 778 Z M1332.4 768 L1348 734 L1363.6 768 Z" />
    <path d="M1350 792 L1405 732 L1460 792 Z M1368 770 L1405 704 L1442 770 Z M1382.8 760 L1405 694 L1427.2 760 Z" />
    <path d="M1390 792 L1440 748 L1490 792 Z M1406 772 L1440 712 L1474 772 Z M1419.6 762 L1440 702 L1460.4 762 Z" />
  </g>
</svg>
    </div>
    <div
      class="animate absolute h-full w-full flex items-center justify-center"
    >
      <div class="relative w-full h-full flex items-center justify-center">
        <div class="p-5 text-center">
          <p
            class="animated text-2xl md:text-3xl lg:text-4xl font-bold text-black dark:text-white"
          >
            You feel the fog.
          </p>
          <p
            class="animated text-2xl md:text-3xl lg:text-4xl font-bold text-black dark:text-white"
          >
            We help you trace what's true.
          </p>
          <p class="animated text-sm md:text-xl lg:text-xl opacity-75">
            There's a reason things feel off.
          </p>
          <p class="animated text-sm md:text-xl md:text-xl opacity-75">
            We help you start where you are—by tracing what you’re feeling to
            what’s underneath.
          </p>
          <div
            id="ctaButtons"
            class="animated flex flex-wrap gap-4 justify-center mt-5"
          >
            <a
              href="/symptoms"
              class="py-2 px-4 rounded truncate text-xs md:text-sm lg:text-base bg-black dark:bg-white text-white dark:text-black hover:opacity-75 blend"
            >
              Walk a Fruit Path
            </a>
            <a
              href="/worldviews"
              class="py-2 px-4 truncate rounded text-xs md:text-sm lg:text-base border border-black/25 dark:border-white/25 hover:bg-black/5 hover:dark:bg-white/15 blend"
            >
              Enter the Forests
            </a>
            <a
              href="/foundations"
              class="py-2 px-4 truncate rounded text-xs md:text-sm lg:text-base border border-black/25 dark:border-white/25 hover:bg-black/5 hover:dark:bg-white/15 blend"
            >
              Explore the Foundations
            </a>
          </div>

  </section>

  <div class="relative bg-white dark:bg-black">
    <div class="mx-auto max-w-screen-sm p-5 space-y-24 pb-16">
      <!-- About Section -->
      <section class="animate">
        <article>
          <p>
            <b><i>Canon & Compass</i></b> helps you trace the fruit you see in your
            life back to the root beliefs shaping it — and then re-root in truth.
          </p>
          <p>
            Through <b>Fruit Paths</b>, <b>Foundations</b>, and practices for
            formation, we connect the timeless wisdom of Scripture to the real
            tensions of modern life, showing how faith and reason work together
            to orient your steps.
          </p>
          <p>
            <b>The Forests</b> follow big ideas to their conclusions,
            offering multi-part worldview explorations of competing cultural narratives
            through a biblical lens. Paths grow from trees. Trees grow in a Forest.
          </p>
          <p>
            This isn’t about louder rules or heavier burdens. It’s about seeing
            clearly, walking humbly, and growing the kind of fruit you were made
            for — from the inside out.
          </p>
        </article>
      </section>

      <!-- How It Works Section -->
      <section class="py-16 bg-stone-50 dark:bg-zinc-900">
        <div class="mx-auto max-w-3xl px-6 text-center">
          <h2 class="text-2xl font-serif font-bold text-ink dark:text-white">
            From Symptoms to Foundations
          </h2>
          <p class="mt-3 text-sm text-zinc-600 dark:text-zinc-400">
            Begin with what you notice. Trace it to the root. Re-root in truth.
            Then keep growing with practices that train both your habits and
            your heart.
          </p>
          <p class="mt-3 text-sm text-zinc-600 dark:text-zinc-400">
            Symptoms are often the fruit of a distorted worldview, so we follow
            the trail from what you feel to the story you believe.
          </p>

          <div class="mt-10 space-y-8 text-left">
            <!-- 1) Symptom -->
            <div class="p-5 bg-white dark:bg-zinc-800 rounded-xl shadow-sm">
              <h3 class="font-semibold text-ink dark:text-white">1) Symptom</h3>
              <p class="mt-2 text-sm text-zinc-600 dark:text-zinc-400">
                <strong>What it is:</strong> Start with the visible “fruit” in your
                life — from envy to anxiety — and trace it down through habits, patterns,
                beliefs, and the core lie that sustains them.
              </p>

              <details class="group mt-3">
                <summary
                  class="flex cursor-pointer items-center gap-2 rounded-md px-2 py-2 text-sm text-zinc-700 dark:text-zinc-300 hover:bg-stone-100 dark:hover:bg-zinc-700"
                >
                  <svg
                    class="h-4 w-4 text-zinc-500 transition-transform group-open:rotate-90"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  Example: Envy → The Tree of Comparison
                </summary>
                <div
                  class="mt-2 pl-6 space-y-3 text-sm text-zinc-700 dark:text-zinc-300"
                >
                  <div>
                    <strong>Fruit (visible outcomes):</strong> Bitterness, insecurity,
                    restlessness.
                  </div>
                  <div>
                    <strong>Leaves (habits):</strong> Withholding celebration, passive
                    scrolling.
                  </div>
                  <div>
                    <strong>Branches (patterns):</strong> Resentment, comparison,
                    self-pity.
                  </div>
                  <div>
                    <strong>Trunk (core belief):</strong> “Comparison is how I measure
                    worth.”
                  </div>
                  <div>
                    <strong>Root (core lie):</strong> “God’s goodness is limited
                    — if they win, I lose.”
                  </div>
                </div>
              </details>

              <a
                href="/symptoms"
                class="mt-4 inline-block rounded-lg border border-stone-300 px-4 py-2 text-sm font-semibold text-ink hover:bg-stone-100 dark:hover:bg-zinc-700"
              >
                Start with a Symptom
              </a>
            </div>

            <!-- 2) Truth Tree -->
            <div class="p-5 bg-white dark:bg-zinc-800 rounded-xl shadow-sm">
              <h3 class="font-semibold text-ink dark:text-white">
                2) Truth Tree
              </h3>
              <p class="mt-2 text-sm text-zinc-600 dark:text-zinc-400">
                <strong>What it is:</strong> A gospel-rooted alternative to the lie.
                Truth Trees help you rebuild with a new root (truth), trunk (foundation),
                branches (practices), and fruit (outcomes).
              </p>

              <details class="group mt-3">
                <summary
                  class="flex cursor-pointer items-center gap-2 rounded-md px-2 py-2 text-sm text-zinc-700 dark:text-zinc-300 hover:bg-stone-100 dark:hover:bg-zinc-700"
                >
                  <svg
                    class="h-4 w-4 text-zinc-500 transition-transform group-open:rotate-90"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  Example: Gratitude-Based Identity
                </summary>
                <div
                  class="mt-2 pl-6 space-y-3 text-sm text-zinc-700 dark:text-zinc-300"
                >
                  <div>
                    <strong>Root (truth):</strong> God’s goodness is abundant.
                  </div>
                  <div>
                    <strong>Trunk (foundation):</strong> I’m secure in His provision,
                    not defined by comparison.
                  </div>
                  <div>
                    <strong>Branches (practices):</strong> Celebration, generosity,
                    contentment.
                  </div>
                  <div>
                    <strong>Fruit (outcomes):</strong> Joy, peace, relational freedom.
                  </div>
                </div>
              </details>

              <a
                href="/trees"
                class="mt-4 inline-block rounded-lg border border-stone-300 px-4 py-2 text-sm font-semibold text-ink hover:bg-stone-100 dark:hover:bg-zinc-700"
              >
                Browse Truth Trees
              </a>
            </div>

            <!-- 3) Foundations -->
            <div class="p-5 bg-white dark:bg-zinc-800 rounded-xl shadow-sm">
              <h3 class="font-semibold text-ink dark:text-white">
                3) Foundations
              </h3>
              <p class="mt-2 text-sm text-zinc-600 dark:text-zinc-400">
                <strong>What it is:</strong> The theological and cultural scaffolding
                behind lasting change—structured in three streams:
              </p>

              <div
                class="mt-6 flex flex-col gap-3 sm:flex-row sm:justify-around text-center"
              >
                <a
                  href="/canon_notes"
                  class="inline-block rounded-lg border border-stone-300 bg-white px-5 py-3 text-sm font-semibold text-ink shadow-sm hover:bg-stone-100 dark:bg-zinc-800 dark:border-zinc-600 dark:text-white dark:hover:bg-zinc-700"
                >
                  Canon Notes<br />
                  <span
                    class="text-xs font-normal text-zinc-500 dark:text-zinc-400"
                    >Scripture-rooted devotionals</span
                  >
                </a>
                <a
                  href="/compass_points"
                  class="inline-block rounded-lg border border-stone-300 bg-white px-5 py-3 text-sm font-semibold text-ink shadow-sm hover:bg-stone-100 dark:bg-zinc-800 dark:border-zinc-600 dark:text-white dark:hover:bg-zinc-700"
                >
                  Compass Points<br />
                  <span
                    class="text-xs font-normal text-zinc-500 dark:text-zinc-400"
                    >Cultural analysis + counter-formation</span
                  >
                </a>
                <a
                  href="/pillars"
                  class="inline-block rounded-lg border border-stone-300 bg-white px-5 py-3 text-sm font-semibold text-ink shadow-sm hover:bg-stone-100 dark:bg-zinc-800 dark:border-zinc-600 dark:text-white dark:hover:bg-zinc-700"
                >
                  Pillars<br />
                  <span
                    class="text-xs font-normal text-zinc-500 dark:text-zinc-400"
                    >Theological + worldview essays</span
                  >
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/*
      <!-- Tree Preview Section -->
      <section class="animate">
        <div class="space-y-4">
          <div class="flex justify-between">
            <p class="font-semibold text-black dark:text-white">Recent Trees</p>
            <a
              href="/tree"
              class="w-fit col-span-3 group flex gap-1 items-center underline decoration-[.5px] decoration-black/25 dark:decoration-white/50 hover:decoration-black dark:hover:decoration-white text-black dark:text-white underline-offset-2 blend"
            >
              <span
                class="text-black/75 dark:text-white/75 group-hover:text-black group-hover:dark:text-white blend"
              >
                All Trees
              </span>
            </a>
          </div>
          <ul class="space-y-4">
            {
              posts.map((post) => (
                <li>
                  <ArrowCard entry={post} />
                </li>
              ))
            }
          </ul>
        </div>
      </section>

      <!-- Foundations Preview Section -->
      <section class="animate">
        <div class="space-y-4">
          <div class="flex justify-between">
            <p class="font-semibold text-black dark:text-white">
              Recent Foundations
            </p>
            <a
              href="/foundations"
              class="w-fit col-span-3 group flex gap-1 items-center underline decoration-[.5px] decoration-black/25 dark:decoration-white/50 hover:decoration-black dark:hover:decoration-white text-black dark:text-white underline-offset-2 blend"
            >
              <span
                class="text-black/75 dark:text-white/75 group-hover:text-black group-hover:dark:text-white blend"
              >
                All Foundations
              </span>
            </a>
          </div>
          <ul class="space-y-4">
            {
              foundations.map((foundation) => (
                <li>
                  <StackCard
                    title={foundation.data.title}
                    summary={foundation.data.summary}
                    href={`/${foundation.collection}/${foundation.slug}`}
                    collection={foundation.collection}
                    date={foundation.data.date}
                    tags={foundation.data.tags}
                  />
                </li>
              ))
            }
          </ul>
        </div>
      </section>
      */}
    </div>
  </div>
</PageLayout>
