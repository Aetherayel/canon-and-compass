---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import TopLayout from "@layouts/TopLayout.astro";
import BottomLayout from "@layouts/BottomLayout.astro";
import SearchCollection from "@components/SearchCollection";
import { CANONNOTES } from "@consts";

const canonNotes = (await getCollection("canon_notes"))
  .filter((note) => !note.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const tags = [
  ...new Set(canonNotes.flatMap((note) => note.data.tags)),
].sort((a, b) => a.localeCompare(b));

const estimated_initial_size =
  28 + canonNotes.length * 158 + (canonNotes.length - 1) * 12;

// Series: Foundations of Discernment (multi-part Canon Notes)
const fodEntries = (await getCollection("foundations-of-discernment")).filter(
  (e) => !e.data.draft,
);
---

<PageLayout title={CANONNOTES.TITLE} description={CANONNOTES.DESCRIPTION}>
  <TopLayout>
    <div class="animate">
      <h1 class="text-3xl font-semibold text-black dark:text-white mt-2">
        {CANONNOTES.TITLE}
      </h1>
      <div class="mt-1">
        {CANONNOTES.DESCRIPTION}
      </div>
    </div>
  </TopLayout>
  <BottomLayout>
    {fodEntries.length > 0 && (
      <section class="animate">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          Explore Canon Notes Series
        </h2>
        <div class="mt-4">
          <a
            href="/foundations-of-discernment"
            class="group p-4 gap-3 flex items-center border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"
          >
            <div class="w-full group-hover:text-black group-hover:dark:text-white blend">
              <div class="text-sm uppercase">
                {fodEntries.length} part{fodEntries.length === 1 ? "" : "s"}
              </div>
              <div class="font-semibold mt-2 text-black dark:text-white">
                Foundations of Discernment
              </div>
              <div class="text-sm mt-1 opacity-80">
                A 28-day devotional journey designed to cultivate a heart and mind shaped by Godâ€™s truth
              </div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white">
              <line x1="5" y1="12" x2="19" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
              <polyline points="12 5 19 12 12 19" class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
            </svg>
          </a>
        </div>
      </section>
    )}
    <div
      id="search-collection-wrapper"
      class="animate"
      style={{ minHeight: `${estimated_initial_size}px` }}
    >
      <SearchCollection
        client:load
        entry_name={"notes"}
        tags={tags}
        data={canonNotes}
      />
    </div>
  </BottomLayout>
</PageLayout>
