---
import type { CollectionEntry } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import TopLayout from "@layouts/TopLayout.astro";
import BottomLayout from "@layouts/BottomLayout.astro";
import PathwayLinks from "@components/PathwayLinks.astro";

type Props = {
  entry: CollectionEntry<"fruit-path">;
  backHref?: string;
  backLabel?: string;
};

const {
  entry,
  backHref = "/fruit-path",
  backLabel = "Fruit Paths",
} = Astro.props as Props;

const data = entry?.data;
const shiftData = data?.shift;
const treeData = data?.tree;

const treeTitle = treeData?.title ?? data?.title;
const treeSummary = treeData?.summary ?? data?.summary;

const pathwayLabel = data?.label;
const fallbackLabel = shiftData
  ? `${shiftData.fruit ?? shiftData.title} <-> ${treeTitle ?? "Truth"}`
  : treeTitle ?? "Fruit Path";

const title = pathwayLabel ?? fallbackLabel;
const description =
  shiftData?.description ??
  treeSummary ??
  "Trace the fruit to the root and walk into truth.";

const { Content } = await entry.render();
const pathwayId = data?.pathwayId ?? entry.slug;
---

<PageLayout title={title} description={description}>
  <TopLayout>
    <div class="animate">
      <a
        href={backHref}
        class="group w-fit p-1.5 gap-1.5 text-sm flex items-center border rounded hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors duration-300 ease-in-out"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="stroke-current group-hover:stroke-black group-hover:dark:stroke-white"
        >
          <line
            x1="19"
            y1="12"
            x2="5"
            y2="12"
            class="scale-x-0 group-hover:scale-x-100 translate-x-3 group-hover:translate-x-0 transition-all duration-300 ease-in-out"
          />
          <polyline
            points="12 19 5 12 12 5"
            class="translate-x-1 group-hover:translate-x-0 transition-all duration-300 ease-in-out"
          />
        </svg>
        <div class="w-full group-hover:text-black group-hover:dark:text-white transition-colors duration-300 ease-in-out">
          Back to {backLabel}
        </div>
      </a>

      <div class="mt-10">
        <div class="text-xs uppercase tracking-[0.2em] text-zinc-500 dark:text-zinc-400">Fruit Path</div>
        <h1 class="text-3xl font-semibold text-black dark:text-white mt-3">
          {title}
        </h1>
        {description && (
          <p class="mt-2 text-balance text-lg text-zinc-600 dark:text-zinc-400 max-w-prose">
            {description}
          </p>
        )}

        {shiftData?.systemLabel && (
          <div class="mt-4 inline-flex items-center gap-2 text-xs uppercase tracking-wide text-zinc-600 dark:text-zinc-300">
            <span class="rounded-full border border-black/15 dark:border-white/20 px-2 py-1">System</span>
            <span>{shiftData.systemLabel}</span>
          </div>
        )}
      </div>
    </div>
  </TopLayout>

  <BottomLayout>
    <div class="animate">
      <article class="mt-6">
        {Content ? <Content /> : null}
      </article>

      {pathwayId && (
        <div class="mt-10">
          <PathwayLinks
            id={pathwayId}
            showPath={false}
            showShift={false}
            showTree={false}
            heading="Keep Walking This Path"
            blurb="Continue through related pieces that deepen this fruit path."
          />
        </div>
      )}
    </div>
  </BottomLayout>
</PageLayout>
