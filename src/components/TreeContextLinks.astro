---
export interface Props {
  treeHref?: string;
  treeSlug?: string;
  treeLabel?: string;     // visible label for tree link
  treeDesc?: string;      // optional description under the tree link

  shiftHref?: string;
  shiftSlug?: string;
  shiftLabel?: string;    // visible label for shift link
  shiftDesc?: string;     // optional description under the shift link

  heading?: string;       // optional heading text
  blurb?: string;         // optional helper text above links
}

import { getCollection } from "astro:content";

const {
  treeHref,
  treeSlug,
  treeLabel = 'This a part of a larger pathway',
  treeDesc = 'Trace the context from root to fruit.',

  shiftHref,
  shiftSlug,
  shiftLabel = 'See the Symptom',
  shiftDesc = 'See how cultural systems counterfeit this truth.',

  heading = 'Find This in the Tree',
  blurb = 'If you arrived here directly, explore the Symptom or Truth Tree for more context.'
} = Astro.props as Props;

const pathways = await getCollection("pathways");
const pathwayMatch = pathways.find((entry) => {
  const data: any = entry.data;
  return (
    (treeSlug && data?.tree?.slug === treeSlug) ||
    (shiftSlug && data?.shift?.slug === shiftSlug)
  );
});
const pathwayId = pathwayMatch?.id as string | undefined;

const resolvedTreeHref =
  treeHref ??
  (pathwayId
    ? `/fruit-path/${pathwayId}#truth-tree`
    : treeSlug
      ? `/tree/${treeSlug}`
      : undefined);
const resolvedShiftHref =
  shiftHref ??
  (pathwayId
    ? `/fruit-path/${pathwayId}#symptom`
    : shiftSlug
      ? `/tree-shifts/${shiftSlug}`
      : undefined);
---

<section class="mt-8 border border-black/10 dark:border-white/15 rounded-xl p-4 sm:p-5 bg-white/60 dark:bg-zinc-900/50 backdrop-blur">
  <div class="flex items-start gap-3">
    <svg aria-hidden="true" class="mt-0.5 w-5 h-5 text-indigo-600 dark:text-indigo-400 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2" />
    </svg>
    <div class="space-y-2">
      <h3 class="text-base font-semibold text-slate-800 dark:text-zinc-100">{heading}</h3>
      {blurb && (
        <p class="text-sm text-zinc-600 dark:text-zinc-400">{blurb}</p>
      )}
    </div>
  </div>

  <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
    {resolvedShiftHref && (
      <a href={resolvedShiftHref} class="group p-3.5 flex items-center justify-between gap-3 border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors">
        <div class="min-w-0">
          <div class="text-sm font-medium text-slate-800 dark:text-zinc-100 truncate">{shiftLabel}</div>
          {shiftDesc && (
            <div class="text-xs text-zinc-600 dark:text-zinc-400 truncate">{shiftDesc}</div>
          )}
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current text-zinc-500 group-hover:text-black group-hover:dark:text-white">
          <line x1="5" y1="12" x2="19" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
          <polyline points="12 5 19 12 12 19" class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
        </svg>
      </a>
    )}
    {resolvedTreeHref && (
      <a href={resolvedTreeHref} class="group p-3.5 flex items-center justify-between gap-3 border rounded-lg hover:bg-black/5 hover:dark:bg-white/10 border-black/15 dark:border-white/20 transition-colors">
        <div class="min-w-0">
          <div class="text-sm font-medium text-slate-800 dark:text-zinc-100 truncate">{treeLabel}</div>
          {treeDesc && (
            <div class="text-xs text-zinc-600 dark:text-zinc-400 truncate">{treeDesc}</div>
          )}
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-current text-zinc-500 group-hover:text-black group-hover:dark:text-white">
          <line x1="5" y1="12" x2="19" y2="12" class="scale-x-0 group-hover:scale-x-100 translate-x-4 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
          <polyline points="12 5 19 12 12 19" class="translate-x-0 group-hover:translate-x-1 transition-all duration-300 ease-in-out" />
        </svg>
      </a>
    )}

  </div>
  {!(resolvedTreeHref || resolvedShiftHref) && (
    <p class="mt-2 text-xs text-amber-600 dark:text-amber-400">No tree or shift link provided.</p>
  )}
  <div class="mt-2 text-[10px] uppercase tracking-wide text-zinc-400 dark:text-zinc-500">Tree Context</div>
  
</section>
